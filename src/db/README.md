# Система миграций базы данных

В проекте используется Drizzle ORM для работы с базой данных PostgreSQL. Схема базы данных определяется в файле `schema.ts`, а миграции генерируются и применяются автоматически.

## Команды для работы с базой данных

В package.json определены следующие скрипты:

- `npm run db:generate` - генерирует миграции на основе изменений в схеме
- `npm run migrate` - применяет миграции к базе данных
- `npm run seed:admin` - заполняет базу начальными данными
- `npm run db:push` - применяет изменения схемы к базе данных напрямую (без генерации миграций)
- `npm run db:studio` - запускает веб-интерфейс для просмотра базы данных

## Структура директорий

- `src/db/schema.ts` - определение схемы базы данных
- `src/db/migrate.ts` - функции для запуска миграций
- `src/db/migrate-cli.ts` - CLI-скрипт для запуска миграций
- `src/db/generate-migration.ts` - скрипт для генерации миграций
- `src/db/seed/` - скрипты для заполнения базы начальными данными
- `drizzle/` - сгенерированные SQL-файлы миграций

## Рабочий процесс

1. Внесите изменения в схему базы данных (`schema.ts`)
2. Сгенерируйте миграции: `npm run db:generate`
3. Проверьте сгенерированные SQL-файлы в директории `drizzle/`
4. Примените миграции: `npm run migrate`
5. При необходимости заполните базу начальными данными: `npm run seed:admin`

## В production

В production среде миграции запускаются автоматически при запуске контейнера через `entrypoint.sh`.
